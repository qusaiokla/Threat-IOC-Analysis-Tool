<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Threat IOC Analysis Tool</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #0d6efd;
            --secondary: #6c757d;
            --success: #198754;
            --warning: #fd7e14;
            --danger: #dc3545;
            --light: #f8f9fa;
            --dark: #212529;
        }
        
        body {
            background-color: #f8f9fa;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            padding-bottom: 50px;
        }
        .card {
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
            border: none;
            transition: transform 0.3s ease;
        }
        .card:hover {
            transform: translateY(-5px);
        }
        .card-header {
            background-color: var(--primary);
            color: white;
            border-radius: 10px 10px 0 0 !important;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .badge {
            padding: 8px 12px;
            border-radius: 20px;
            font-weight: 500;
        }
        .badge-malicious {
            background-color: var(--danger);
        }
        .badge-suspicious {
            background-color: var(--warning);
        }
        .badge-benign {
            background-color: var(--success);
        }
        .btn-primary {
            background-color: var(--primary);
            border: none;
            padding: 10px 20px;
            transition: all 0.3s ease;
        }
        .btn-primary:hover {
            background-color: #0b5ed7;
            transform: scale(1.05);
        }
        .tab-content {
            padding: 20px;
            border: 1px solid #dee2e6;
            border-top: none;
            border-radius: 0 0 10px 10px;
            background-color: white;
        }
        .nav-tabs .nav-link {
            color: var(--secondary);
            font-weight: 500;
        }
        .nav-tabs .nav-link.active {
            font-weight: 600;
            background-color: white;
            border-color: #dee2e6 #dee2e6 white;
            color: var(--primary);
        }
        #jsonOutput {
            min-height: 200px;
            font-family: monospace;
            font-size: 14px;
            white-space: pre-wrap;
        }
        .progress {
            height: 8px;
            margin-top: 5px;
        }
        .risk-low {
            background-color: var(--success);
        }
        .risk-medium {
            background-color: var(--warning);
        }
        .risk-high {
            background-color: var(--danger);
        }
        .tool-section {
            margin-bottom: 30px;
        }
        .history-item {
            padding: 10px 15px;
            border-left: 4px solid var(--primary);
            margin-bottom: 10px;
            background-color: #f8f9fa;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        .history-item:hover {
            background-color: #e9ecef;
            transform: translateX(5px);
        }
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 9999;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }
        .copy-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            opacity: 0.7;
            transition: opacity 0.3s ease;
        }
        .copy-btn:hover {
            opacity: 1;
        }
        .stats-card {
            text-align: center;
            padding: 15px;
        }
        .stats-number {
            font-size: 2rem;
            font-weight: bold;
        }
        .stats-label {
            font-size: 0.9rem;
            color: var(--secondary);
        }
        .tooltip-icon {
            cursor: help;
            margin-left: 5px;
            color: var(--secondary);
        }
        .recent-scans {
            max-height: 300px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <div class="container py-5">
        <div class="row">
            <div class="col-lg-10 mx-auto">
                <h1 class="text-center mb-2"><i class="fas fa-shield-alt me-2"></i>Threat IOC Analysis Tool</h1>
                <p class="text-center text-muted mb-5">Analyze URLs, domains, IP addresses, and file hashes to determine if they are malicious or benign</p>
                
                <div class="row mb-4">
                    <div class="col-md-3">
                        <div class="card stats-card">
                            <div class="stats-number text-primary" id="totalScans">0</div>
                            <div class="stats-label">Total Scans</div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card stats-card">
                            <div class="stats-number text-danger" id="maliciousCount">0</div>
                            <div class="stats-label">Malicious</div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card stats-card">
                            <div class="stats-number text-warning" id="suspiciousCount">0</div>
                            <div class="stats-label">Suspicious</div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card stats-card">
                            <div class="stats-number text-success" id="benignCount">0</div>
                            <div class="stats-label">Benign</div>
                        </div>
                    </div>
                </div>
                
                <div class="card tool-section">
                    <div class="card-header">
                        <h5 class="mb-0"><i class="fas fa-search me-2"></i>Indicator Input</h5>
                        <button class="btn btn-sm btn-light" id="clearHistoryBtn">
                            <i class="fas fa-trash-alt me-1"></i>Clear History
                        </button>
                    </div>
                    <div class="card-body">
                        <ul class="nav nav-tabs" id="iocTab" role="tablist">
                            <li class="nav-item" role="presentation">
                                <button class="nav-link active" id="url-tab" data-bs-toggle="tab" data-bs-target="#url" type="button" role="tab">URL</button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="domain-tab" data-bs-toggle="tab" data-bs-target="#domain" type="button" role="tab">Domain</button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="ip-tab" data-bs-toggle="tab" data-bs-target="#ip" type="button" role="tab">IP Address</button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="hash-tab" data-bs-toggle="tab" data-bs-target="#hash" type="button" role="tab">File Hash</button>
                            </li>
                        </ul>
                        
                        <div class="tab-content" id="iocTabContent">
                            <div class="tab-pane fade show active" id="url" role="tabpanel">
                                <div class="mb-3 mt-3">
                                    <label for="urlInput" class="form-label">Enter URL to analyze <i class="fas fa-question-circle tooltip-icon" title="Enter a complete URL including http:// or https://"></i></label>
                                    <input type="text" class="form-control" id="urlInput" placeholder="https://example.com/suspicious">
                                </div>
                            </div>
                            <div class="tab-pane fade" id="domain" role="tabpanel">
                                <div class="mb-3 mt-3">
                                    <label for="domainInput" class="form-label">Enter domain to analyze <i class="fas fa-question-circle tooltip-icon" title="Enter a domain name without http:// or https://"></i></label>
                                    <input type="text" class="form-control" id="domainInput" placeholder="example.com">
                                </div>
                            </div>
                            <div class="tab-pane fade" id="ip" role="tabpanel">
                                <div class="mb-3 mt-3">
                                    <label for="ipInput" class="form-label">Enter IP address to analyze <i class="fas fa-question-circle tooltip-icon" title="Enter a valid IPv4 or IPv6 address"></i></label>
                                    <input type="text" class="form-control" id="ipInput" placeholder="192.168.1.1">
                                </div>
                            </div>
                            <div class="tab-pane fade" id="hash" role="tabpanel">
                                <div class="mb-3 mt-3">
                                    <label for="hashInput" class="form-label">Enter file hash (MD5, SHA-1, or SHA-256) <i class="fas fa-question-circle tooltip-icon" title="Enter a 32-character MD5, 40-character SHA-1, or 64-character SHA-256 hash"></i></label>
                                    <input type="text" class="form-control" id="hashInput" placeholder="44d88612fea8a8f36de82e1278abb02f">
                                </div>
                            </div>
                        </div>
                        
                        <div class="d-grid gap-2 mt-3">
                            <button class="btn btn-primary" id="analyzeBtn">
                                <i class="fas fa-play-circle me-2"></i>Analyze Indicator
                            </button>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-8">
                        <div class="card tool-section">
                            <div class="card-header">
                                <h5 class="mb-0"><i class="fas fa-table me-2"></i>Analysis Results</h5>
                                <button class="btn btn-sm btn-light" id="exportCsvBtn">
                                    <i class="fas fa-download me-1"></i>Export CSV
                                </button>
                            </div>
                            <div class="card-body">
                                <div class="table-responsive">
                                    <table class="table table-hover" id="resultsTable">
                                        <thead>
                                            <tr>
                                                <th>Indicator</th>
                                                <th>Type</th>
                                                <th>Verdict</th>
                                                <th>Confidence</th>
                                                <th>Sources</th>
                                                <th>Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td colspan="6" class="text-center py-4">No analysis performed yet</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-4">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="mb-0"><i class="fas fa-history me-2"></i>Recent Scans</h5>
                            </div>
                            <div class="card-body recent-scans" id="scanHistory">
                                <p class="text-muted text-center py-3">No scan history yet</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0"><i class="fas fa-code me-2"></i>JSON Report</h5>
                        <button class="btn btn-sm btn-light" id="copyJsonBtn">
                            <i class="fas fa-copy me-1"></i>Copy JSON
                        </button>
                    </div>
                    <div class="card-body position-relative">
                        <button class="btn btn-sm btn-outline-secondary copy-btn" id="copyJsonBtnInline">
                            <i class="fas fa-copy"></i>
                        </button>
                        <pre id="jsonOutput" class="p-3 bg-light rounded">{
    "analysis": [],
    "summary": {
        "total_indicators": 0,
        "malicious": 0,
        "suspicious": 0,
        "benign": 0
    }
}</pre>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="toast" id="notificationToast" role="alert" aria-live="assertive" aria-atomic="true">
        <div class="toast-header">
            <strong class="me-auto" id="toastTitle">Notification</strong>
            <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
        </div>
        <div class="toast-body" id="toastMessage">
            Operation completed successfully.
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize elements
            const analyzeBtn = document.getElementById('analyzeBtn');
            const resultsTable = document.getElementById('resultsTable');
            const jsonOutput = document.getElementById('jsonOutput');
            const scanHistory = document.getElementById('scanHistory');
            const copyJsonBtn = document.getElementById('copyJsonBtn');
            const copyJsonBtnInline = document.getElementById('copyJsonBtnInline');
            const exportCsvBtn = document.getElementById('exportCsvBtn');
            const clearHistoryBtn = document.getElementById('clearHistoryBtn');
            const toast = new bootstrap.Toast(document.getElementById('notificationToast'));
            
            // Stats counters
            const totalScans = document.getElementById('totalScans');
            const maliciousCount = document.getElementById('maliciousCount');
            const suspiciousCount = document.getElementById('suspiciousCount');
            const benignCount = document.getElementById('benignCount');
            
            // Load data from localStorage
            let scanResults = JSON.parse(localStorage.getItem('scanResults')) || [];
            let stats = JSON.parse(localStorage.getItem('stats')) || {
                total: 0,
                malicious: 0,
                suspicious: 0,
                benign: 0
            };
            
            // Update stats display
            function updateStatsDisplay() {
                totalScans.textContent = stats.total;
                maliciousCount.textContent = stats.malicious;
                suspiciousCount.textContent = stats.suspicious;
                benignCount.textContent = stats.benign;
            }
            
            // Initialize stats display
            updateStatsDisplay();
            
            // Show notification
            function showNotification(title, message, type = 'info') {
                document.getElementById('toastTitle').textContent = title;
                document.getElementById('toastMessage').textContent = message;
                
                const toastHeader = document.querySelector('#notificationToast .toast-header');
                toastHeader.classList.remove('bg-primary', 'bg-success', 'bg-danger', 'bg-warning');
                
                if (type === 'success') toastHeader.classList.add('bg-success', 'text-white');
                else if (type === 'error') toastHeader.classList.add('bg-danger', 'text-white');
                else if (type === 'warning') toastHeader.classList.add('bg-warning');
                else toastHeader.classList.add('bg-primary', 'text-white');
                
                toast.show();
            }
            
            // Update scan history
            function updateScanHistory() {
                if (scanResults.length === 0) {
                    scanHistory.innerHTML = '<p class="text-muted text-center py-3">No scan history yet</p>';
                    return;
                }
                
                scanHistory.innerHTML = '';
                // Show only the 5 most recent scans
                const recentScans = scanResults.slice(-5).reverse();
                
                recentScans.forEach(result => {
                    const historyItem = document.createElement('div');
                    historyItem.className = 'history-item';
                    
                    // Determine badge class based on verdict
                    let badgeClass = 'badge-benign';
                    if (result.verdict === 'Malicious') badgeClass = 'badge-malicious';
                    if (result.verdict === 'Suspicious') badgeClass = 'badge-suspicious';
                    
                    historyItem.innerHTML = `
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <strong>${result.indicator}</strong>
                                <div class="small text-muted">${result.type} • ${new Date(result.timestamp).toLocaleString()}</div>
                            </div>
                            <span class="badge ${badgeClass}">${result.verdict}</span>
                        </div>
                    `;
                    
                    // Add click event to load this result
                    historyItem.addEventListener('click', () => {
                        loadResultIntoTable([result]);
                        updateJsonOutput([result]);
                    });
                    
                    scanHistory.appendChild(historyItem);
                });
            }
            
            // Initialize scan history
            updateScanHistory();
            
            // Load result into table
            function loadResultIntoTable(results) {
                const tbody = resultsTable.querySelector('tbody');
                tbody.innerHTML = '';
                
                if (results.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="6" class="text-center py-4">No analysis performed yet</td></tr>';
                    return;
                }
                
                results.forEach(result => {
                    const row = document.createElement('tr');
                    
                    // Determine badge class based on verdict
                    let badgeClass = 'badge-benign';
                    if (result.verdict === 'Malicious') badgeClass = 'badge-malicious';
                    if (result.verdict === 'Suspicious') badgeClass = 'badge-suspicious';
                    
                    // Determine risk level for confidence
                    let riskLevel = 'risk-low';
                    if (result.confidence > 85) riskLevel = 'risk-high';
                    else if (result.confidence > 60) riskLevel = 'risk-medium';
                    
                    row.innerHTML = `
                        <td>${result.indicator}</td>
                        <td>${result.type}</td>
                        <td><span class="badge ${badgeClass}">${result.verdict}</span></td>
                        <td>
                            <div>${result.confidence}%</div>
                            <div class="progress">
                                <div class="progress-bar ${riskLevel}" role="progressbar" style="width: ${result.confidence}%"></div>
                            </div>
                        </td>
                        <td>${result.sources}</td>
                        <td>
                            <button class="btn btn-sm btn-outline-danger delete-btn" data-id="${result.id}">
                                <i class="fas fa-trash-alt"></i>
                            </button>
                        </td>
                    `;
                    
                    tbody.appendChild(row);
                });
                
                // Add event listeners to delete buttons
                document.querySelectorAll('.delete-btn').forEach(btn => {
                    btn.addEventListener('click', function(e) {
                        e.stopPropagation();
                        const id = this.getAttribute('data-id');
                        deleteResult(id);
                    });
                });
            }
            
            // Delete a result
            function deleteResult(id) {
                if (confirm('Are you sure you want to delete this result?')) {
                    scanResults = scanResults.filter(result => result.id !== id);
                    localStorage.setItem('scanResults', JSON.stringify(scanResults));
                    
                    // Reload table and history
                    loadResultIntoTable(scanResults);
                    updateScanHistory();
                    updateJsonOutput(scanResults);
                    
                    showNotification('Success', 'Result deleted successfully', 'success');
                }
            }
            
            // Update JSON output
            function updateJsonOutput(results) {
                const analysisReport = {
                    analysis: results.map(result => ({
                        indicator: result.indicator,
                        type: result.type,
                        verdict: result.verdict,
                        confidence: result.confidence,
                        sources: result.sources.split(', '),
                        timestamp: result.timestamp
                    })),
                    summary: {
                        total_indicators: results.length,
                        malicious: results.filter(r => r.verdict === 'Malicious').length,
                        suspicious: results.filter(r => r.verdict === 'Suspicious').length,
                        benign: results.filter(r => r.verdict === 'Benign').length
                    }
                };
                
                jsonOutput.textContent = JSON.stringify(analysisReport, null, 4);
            }
            
            // Validate inputs
            function validateInput(type, value) {
                if (!value) return 'Please enter a value to analyze';
                
                switch(type) {
                    case 'url':
                        try {
                            new URL(value);
                        } catch (e) {
                            return 'Please enter a valid URL (include http:// or https://)';
                        }
                        break;
                    case 'domain':
                        const domainRegex = /^[a-zA-Z0-9]([a-zA-Z0-9\-]{0,61}[a-zA-Z0-9])?(\.[a-zA-Z]{2,})+$/;
                        if (!domainRegex.test(value)) return 'Please enter a valid domain name';
                        break;
                    case 'ip':
                        const ipRegex = /^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/;
                        if (!ipRegex.test(value)) return 'Please enter a valid IP address';
                        break;
                    case 'hash':
                        const md5Regex = /^[a-f0-9]{32}$/i;
                        const sha1Regex = /^[a-f0-9]{40}$/i;
                        const sha256Regex = /^[a-f0-9]{64}$/i;
                        
                        if (!md5Regex.test(value) && !sha1Regex.test(value) && !sha256Regex.test(value)) {
                            return 'Please enter a valid MD5, SHA-1, or SHA-256 hash';
                        }
                        break;
                }
                
                return null;
            }
            
            // Sample data for demonstration
            const sampleData = {
                url: [
                    {
                        indicator: 'http://malicious-example.com/phishing',
                        type: 'URL',
                        verdict: 'Malicious',
                        confidence: 95,
                        sources: 'VirusTotal, URLScan, ThreatFox'
                    },
                    {
                        indicator: 'https://benign-website.org/data',
                        type: 'URL',
                        verdict: 'Benign',
                        confidence: 98,
                        sources: 'VirusTotal, URLScan'
                    }
                ],
                domain: [
                    {
                        indicator: 'bad-domain.net',
                        type: 'Domain',
                        verdict: 'Suspicious',
                        confidence: 75,
                        sources: 'CISA Blocklist, AbuseIPDB'
                    },
                    {
                        indicator: 'trusted-site.com',
                        type: 'Domain',
                        verdict: 'Benign',
                        confidence: 92,
                        sources: 'VirusTotal, Cisco Talos'
                    }
                ],
                ip: [
                    {
                        indicator: '192.168.1.100',
                        type: 'IP Address',
                        verdict: 'Benign',
                        confidence: 98,
                        sources: 'AbuseIPDB, AlienVault OTX'
                    },
                    {
                        indicator: '10.0.0.25',
                        type: 'IP Address',
                        verdict: 'Malicious',
                        confidence: 87,
                        sources: 'AbuseIPDB, FireHOL Blocklist'
                    }
                ],
                hash: [
                    {
                        indicator: '44d88612fea8a8f36de82e1278abb02f',
                        type: 'File Hash',
                        verdict: 'Malicious',
                        confidence: 100,
                        sources: 'VirusTotal, Any.run'
                    },
                    {
                        indicator: 'a94a8fe5ccb19ba61c4c0873d391e987982fbbd3',
                        type: 'File Hash',
                        verdict: 'Benign',
                        confidence: 96,
                        sources: 'VirusTotal, Hybrid Analysis'
                    }
                ]
            };
            
            // Function to simulate API calls
            function simulateAPICall(type, value) {
                return new Promise((resolve) => {
                    setTimeout(() => {
                        let result;
                        
                        // For demo purposes, return sample data based on input
                        if (type === 'url') {
                            if (value.includes('malicious')) {
                                result = sampleData.url[0];
                            } else {
                                result = sampleData.url[1];
                            }
                        } else if (type === 'domain') {
                            if (value.includes('bad')) {
                                result = sampleData.domain[0];
                            } else {
                                result = sampleData.domain[1];
                            }
                        } else if (type === 'ip') {
                            if (value === '10.0.0.25') {
                                result = sampleData.ip[1];
                            } else {
                                result = sampleData.ip[0];
                            }
                        } else if (type === 'hash') {
                            if (value === '44d88612fea8a8f36de82e1278abb02f') {
                                result = sampleData.hash[0];
                            } else {
                                result = sampleData.hash[1];
                            }
                        } else {
                            // Default benign result
                            result = {
                                indicator: value,
                                type: type.charAt(0).toUpperCase() + type.slice(1),
                                verdict: 'Benign',
                                confidence: 90,
                                sources: 'VirusTotal, URLScan'
                            };
                        }
                        
                        // Add ID and timestamp
                        result.id = Date.now().toString();
                        result.timestamp = new Date().toISOString();
                        
                        resolve(result);
                    }, 1500); // Simulate network delay
                });
            }
            
            // Analyze button click event
            analyzeBtn.addEventListener('click', async function() {
                // Get active tab and input value
                const activeTab = document.querySelector('#iocTab .nav-link.active');
                const activeTabId = activeTab.getAttribute('data-bs-target').substring(1);
                const inputField = document.getElementById(activeTabId + 'Input');
                const inputValue = inputField.value.trim();
                
                // Validate input
                const error = validateInput(activeTabId, inputValue);
                if (error) {
                    showNotification('Input Error', error, 'error');
                    return;
                }
                
                // Show loading state
                analyzeBtn.disabled = true;
                analyzeBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Analyzing...';
                
                // Simulate API call
                try {
                    const result = await simulateAPICall(activeTabId, inputValue);
                    
                    // Add to scan results
                    scanResults.push(result);
                    localStorage.setItem('scanResults', JSON.stringify(scanResults));
                    
                    // Update stats
                    stats.total++;
                    if (result.verdict === 'Malicious') stats.malicious++;
                    else if (result.verdict === 'Suspicious') stats.suspicious++;
                    else stats.benign++;
                    
                    localStorage.setItem('stats', JSON.stringify(stats));
                    updateStatsDisplay();
                    
                    // Update UI
                    loadResultIntoTable(scanResults);
                    updateScanHistory();
                    updateJsonOutput(scanResults);
                    
                    showNotification('Analysis Complete', `Analysis of ${result.indicator} completed successfully`, 'success');
                } catch (error) {
                    showNotification('Analysis Error', 'Error analyzing indicator: ' + error.message, 'error');
                } finally {
                    // Reset button state
                    analyzeBtn.disabled = false;
                    analyzeBtn.innerHTML = '<i class="fas fa-play-circle me-2"></i>Analyze Indicator';
                }
            });
            
            // Copy JSON button click event
            copyJsonBtn.addEventListener('click', function() {
                copyJsonBtnInline.click(); // Trigger the inline button click
            });
            
            copyJsonBtnInline.addEventListener('click', function() {
                navigator.clipboard.writeText(jsonOutput.textContent)
                    .then(() => {
                        showNotification('Copied', 'JSON report copied to clipboard', 'success');
                    })
                    .catch(err => {
                        showNotification('Error', 'Failed to copy JSON: ' + err, 'error');
                    });
            });
            
            // Export CSV button click event
            exportCsvBtn.addEventListener('click', function() {
                if (scanResults.length === 0) {
                    showNotification('Export Error', 'No data to export', 'error');
                    return;
                }
                
                // Create CSV content
                let csvContent = "Indicator,Type,Verdict,Confidence,Sources,Timestamp\n";
                
                scanResults.forEach(result => {
                    csvContent += `"${result.indicator}",${result.type},${result.verdict},${result.confidence},"${result.sources}",${result.timestamp}\n`;
                });
                
                // Create download link
                const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
                const url = URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.setAttribute('href', url);
                link.setAttribute('download', 'threat_analysis_results.csv');
                link.style.visibility = 'hidden';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                
                showNotification('Export Complete', 'CSV file downloaded successfully', 'success');
            });
            
            // Clear history button click event
            clearHistoryBtn.addEventListener('click', function() {
                if (scanResults.length === 0) {
                    showNotification('Info', 'No history to clear', 'info');
                    return;
                }
                
                if (confirm('Are you sure you want to clear all scan history? This action cannot be undone.')) {
                    scanResults = [];
                    stats = { total: 0, malicious: 0, suspicious: 0, benign: 0 };
                    
                    localStorage.removeItem('scanResults');
                    localStorage.removeItem('stats');
                    
                    loadResultIntoTable([]);
                    updateScanHistory();
                    updateJsonOutput([]);
                    updateStatsDisplay();
                    
                    showNotification('History Cleared', 'All scan history has been cleared', 'success');
                }
            });
            
            // Load existing results on page load
            loadResultIntoTable(scanResults);
            updateJsonOutput(scanResults);
        });
    </script>
</body>
</html>